import getConfig from 'next/config';
import useSWR from 'swr';
import {evolve} from 'ramda';

const { publicRuntimeConfig } = getConfig();

const request = async (url, options = {}) => {
  try {
    const response = await fetch(url, {
      headers: {
        Authorization: publicRuntimeConfig.apiAuthKey,
        ...options.headers,
      },
      ...evolve({body: JSON.stringify}, options)
    });
    return response.json();
  } catch (err) {

  }
};

export default {
  get: (url) => {
    const { data, error } = useSWR(url, request);
  
    return {
      data,
      isLoading: !error && !data,
      isError: error,
    };
  },

  post: (url, body) => request(url, {method: 'post', body}),

  put: (url, body) => request(url, {method: 'put', body}),

  delete: (url) => request(url, {method: 'delete'}),
};
